<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign up â€¢ Instagram</title>
  <link rel="stylesheet" href="signup.css" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <script>
    // Check if already logged in
    fetch('/api/auth/me').then(res => {
      if (res.ok) window.location.href = '/';
    });
  </script>
  <style>
    .hidden {
      display: none;
    }

    select {
      width: 100%;
      background: #fafafa;
      border: 1px solid #dbdbdb;
      border-radius: 3px;
      padding: 9px 0 7px 8px;
      margin-bottom: 6px;
      box-sizing: border-box;
      color: #262626;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <main>
    <div class="container">
      <div class="phones-container">
        <img src="phones.png" alt="Instagram App" class="phones-img">
      </div>

      <div class="login-container">
        <div class="box login-box">
          <h1 class="logo">Instagram</h1>
          <h2
            style="color: #8e8e8e; font-size: 17px; font-weight: 600; line-height: 20px; margin: 0 40px 10px; text-align: center;">
            Sign up to see photos and videos from your friends.</h2>

          <form class="login-form">
            <!-- Step 1: Basic Info -->
            <div id="step-1">
              <div class="input-group">
                <input type="text" id="name" placeholder="Full Name" required>
              </div>
              <div class="input-group">
                <input type="text" id="username" placeholder="Username" required>
              </div>
              <div class="input-group">
                <input type="email" id="email" placeholder="Email" required>
              </div>
              <div class="input-group">
                <input type="password" id="password" placeholder="Password" required>
              </div>
              <button type="button" class="login-btn" id="next-btn">Next</button>
            </div>

            <!-- Step 2: Account Details -->
            <div id="step-2" class="hidden">
              <div class="input-group">
                <select id="account_type" required>
                  <option value="" disabled selected>Select Account Type</option>
                  <option value="Normal">Normal Account</option>
                  <option value="Business">Business Account</option>
                </select>
              </div>

              <!-- Normal Account Fields -->
              <div id="normal-fields" class="hidden">
                <div class="input-group">
                  <select id="gender">
                    <option value="" disabled selected>Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
              </div>

              <!-- Business Account Fields -->
              <div id="business-fields" class="hidden">
                <div class="input-group">
                  <input type="text" id="business_type" placeholder="Business Type (Optional)">
                </div>
                <div class="input-group">
                  <input type="text" id="contact_no" placeholder="Contact Number (Optional)">
                </div>
                <div class="input-group">
                  <input type="text" id="bio_url" placeholder="Website / Bio URL (Optional)">
                </div>
              </div>

              <button type="submit" class="login-btn">Sign up</button>
              <button type="button" class="login-btn" id="back-btn"
                style="background-color: #fafafa; color: #3897f0; border: 1px solid #dbdbdb; margin-top: 5px;">Back</button>
            </div>

            <div style="text-align: center; margin: 10px 0; font-size: 14px;" id="message"></div>

            <p style="color: #8e8e8e; font-size: 12px; margin-top: 15px; text-align: center;">
              By signing up, you agree to our Terms, Data Policy and Cookies Policy.
            </p>
          </form>
        </div>

        <div class="box signup-box">
          <p>Have an account? <a href="login.html">Log in</a></p>
        </div>

        <div class="get-app">
          <p>Get the app.</p>
          <div class="app-stores">
            <img src="https://static.cdninstagram.com/rsrc.php/v3/yt/r/Yfc020c87j0.png" alt="Get it on Google Play"
              class="store-badge">
            <img src="https://static.cdninstagram.com/rsrc.php/v3/yz/r/c5Rp7Ym-Klz.png" alt="Get it on Microsoft"
              class="store-badge">
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-links">
      <a href="#">Meta</a>
      <a href="#">About</a>
      <a href="#">Blog</a>
      <a href="#">Jobs</a>
      <a href="#">Help</a>
      <a href="#">API</a>
      <a href="#">Privacy</a>
      <a href="#">Terms</a>
      <a href="#">Top Accounts</a>
      <a href="#">Locations</a>
      <a href="#">Instagram Lite</a>
      <a href="#">Threads</a>
      <a href="#">Contact Uploading & Non-Users</a>
      <a href="#">Meta Verified</a>
    </div>
    <div class="copyright">
      &copy; 2024 Instagram from Meta
    </div>
  </footer>

  <script>
    const form = document.querySelector('form');
    const step1 = document.getElementById('step-1');
    const step2 = document.getElementById('step-2');
    const nextBtn = document.getElementById('next-btn');
    const backBtn = document.getElementById('back-btn');
    const accountTypeSelect = document.getElementById('account_type');
    const normalFields = document.getElementById('normal-fields');
    const businessFields = document.getElementById('business-fields');
    const messageDiv = document.getElementById('message');

    // Next Button Logic
    nextBtn.addEventListener('click', () => {
      const name = document.getElementById('name').value;
      const username = document.getElementById('username').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      if (name && username && email && password) {
        step1.classList.add('hidden');
        step2.classList.remove('hidden');
        messageDiv.textContent = ''; // Clear error
      } else {
        messageDiv.style.color = 'red';
        messageDiv.textContent = 'Please fill in all fields.';
      }
    });

    // Back Button Logic
    backBtn.addEventListener('click', () => {
      step2.classList.add('hidden');
      step1.classList.remove('hidden');
      messageDiv.textContent = '';
    });

    // Toggle fields based on account type
    accountTypeSelect.addEventListener('change', (e) => {
      const type = e.target.value;
      if (type === 'Normal') {
        normalFields.classList.remove('hidden');
        businessFields.classList.add('hidden');
      } else {
        normalFields.classList.add('hidden');
        businessFields.classList.remove('hidden');
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messageDiv.textContent = ''; // Clear previous messages

      const accountType = accountTypeSelect.value;

      // Validate Account Type specific fields
      if (accountType === 'Normal') {
        const gender = document.getElementById('gender').value;
        if (!gender) {
          messageDiv.style.color = 'red';
          messageDiv.textContent = 'Please select a gender.';
          return;
        }
      }

      const data = {
        name: document.getElementById('name').value,
        username: document.getElementById('username').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        account_type: accountType
      };

      if (accountType === 'Normal') {
        data.gender = document.getElementById('gender').value;
      } else {
        data.business_type = document.getElementById('business_type').value;
        data.contact_no = document.getElementById('contact_no').value;
        data.bio_url = document.getElementById('bio_url').value;
      }

      try {
        const res = await fetch('/api/auth/signup', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await res.json();

        if (res.ok) {
          // Success: Redirect to login
          messageDiv.style.color = 'green';
          messageDiv.textContent = 'Account created! Redirecting to login...';
          setTimeout(() => {
            window.location.href = 'login.html';
          }, 1500);
        } else {
          // Error: Show message
          messageDiv.style.color = 'red';
          messageDiv.textContent = result.message || 'Signup failed';
        }
      } catch (err) {
        messageDiv.style.color = 'red';
        messageDiv.textContent = 'Error sending request';
        console.error(err);
      }
    });
  </script>
</body>

</html>